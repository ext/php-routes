#!/usr/bin/env php
<?php

function usage(){
	global $argv;
	echo "usage: {$argv[0]} FILENAME METHOD URL\n";
	exit;
}

/* hack to find composer autoloader, kind of stolen from phpunit  */
foreach (array(__DIR__ . '/../../../autoload.php', __DIR__ . '/../../vendor/autoload.php', __DIR__ . '/../vendor/autoload.php', __DIR__ . '/vendor/autoload.php') as $file) {
	if (file_exists($file)) {
		require $file;
	}
}

if ( $argc === 1 ){
	usage();
}

$filename = $argv[1];
$router = new Sidvind\PHPRoutes\Router($filename);

if ( $argc === 2 ){
	$router->printRoutes();
} else if ( $argc == 4 ){
	$method = strtoupper($argv[2]);
	$url = $argv[3];
	$match = $router->match($url, $method);
	if ( $match ){
		echo "Controller: {$match->controller}\n";
		echo "Action: {$match->action}\n";
		echo "Format: {$match->format}\n";
		echo "Arguments:\n";
		echo json_encode($match->args, JSON_PRETTY_PRINT);
	} else {
		echo "{$argv[0]}: url doesn't match any route.\n";
		exit(1);
	}
} else {
	usage();
}
